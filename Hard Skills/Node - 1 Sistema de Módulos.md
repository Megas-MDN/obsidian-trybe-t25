[[Node]]
[[Object Destructuring]]

- [Exportando m√≥dulos](#Exportando%0dm√≥dulos)
- [Importando m√≥dulos](#Importando%0dm√≥dulos)


Dados do site¬†[ModuleCounts.com](http://www.modulecounts.com/)¬†mostram que atualmente o NPM, onde os pacotes Node.js s√£o disponibilizados, est√° entre os reposit√≥rios com maior n√∫mero de pacotes.

> Ter muitos pacotes publicados no reposit√≥rio atual, nos d√° uma ideia de duas grandes vantagens do Node.js: uma comunidade extremamente ativa e uma grande quantidade de ferramentas para resolver os mais diversos tipos de problema.

Mas, o que √© um pacote Node e como podemos utiliz√°-los no nosso c√≥digo?ü§î

Iremos chegar a essa resposta em breve, mas antes disso voc√™ precisa saber o que √© um¬†**m√≥dulo em Node.js**. ü§ì

> üé¨ Caso voc√™ prefira consumir este conte√∫do em v√≠deo, ele est√° dispon√≠vel mais adiante nesta se√ß√£o.

Anota a√≠ üñä: um m√≥dulo em Node.js √© um ‚Äúpeda√ßo de c√≥digo‚Äù, o qual pode ser organizado em um ou mais arquivos, que possui escopo pr√≥prio. Ou seja, suas vari√°veis, fun√ß√µes, classes e afins s√≥ est√£o dispon√≠veis nos arquivos que fazem parte daquele m√≥dulo.

Em outras palavras, um m√≥dulo √© uma funcionalidade, ou um conjunto de funcionalidades, que se encontram isoladas do restante do c√≥digo.¬†**O Node.js possui tr√™s tipos de m√≥dulos:**¬†internos, locais e de terceiros.

## M√≥dulos internos

Os m√≥dulos internos (ou¬†_core modules_) s√£o inclusos no Node.js e instalados junto com ele quando baixamos o¬†_runtime_. Alguns exemplos de¬†_core modules_¬†s√£o:

-   [`fs`](https://nodejs.org/api/fs.html): fornece uma API para interagir com o sistema de arquivos de forma geral;
-   [`url`](https://nodejs.org/api/url.html): prov√™ utilit√°rios para ler e manipular URLs;
-   [`util`](https://nodejs.org/api/util.html): oferece ferramentas e funcionalidades comumente √∫teis a pessoas programadoras.
-   [`os`](https://nodejs.org/api/os.html): oferece ferramentas e funcionalidades relacionadas ao sistema operacional.

‚ö†Ô∏è¬†**Aviso**: clique no nome de cada m√≥dulo para abrir a documenta√ß√£o oficial (em ingl√™s).

## M√≥dulos locais

Os m√≥dulos locais s√£o aqueles definidos juntamente √† nossa aplica√ß√£o. Eles representam as funcionalidades ou partes do nosso programa que foram separados em arquivos diferentes. Podem ser publicados no NPM, para que outras pessoas possam baix√°-los e utiliz√°-los, o que nos leva ao nosso pr√≥ximo e √∫ltimo tipo de m√≥dulo.

## M√≥dulos de terceiros

Os m√≥dulos de terceiros s√£o aqueles criados por outras pessoas desenvolvedoras e disponibilizados para uso por meio do¬†`npm`. N√≥s tamb√©m podemos criar e publicar nossos pr√≥prios m√≥dulos, seja para utilizarmos em diversas aplica√ß√µes diferentes, seja para permitir que outras pessoas os utilizem. Veremos como fazer isso adiante, para isso continue a leitura.


## Maneiras de importar e exportar m√≥dulos

Quando queremos utilizar o conte√∫do de um m√≥dulo ou pacote de outro arquivo no Node.js, precisamos¬†**importar**¬†esse m√≥dulo/pacote para o contexto atual no qual estamos.

Para isso, existem dois sistemas de m√≥dulos difundidos na comunidade JavaScript:

-   M√≥dulos¬†**ES6**;
    
-   M√≥dulos¬†**CommonJS**.
    

## ES6

O nome ES6 vem de ECMAScript 6 (especifica√ß√£o seguida pelo JavaScript).

> Nessa especifica√ß√£o, os m√≥dulos s√£o importados utilizando a palavra-chave¬†`import`, tendo como contrapartida a palavra-chave¬†`export`¬†para export√°-los.

O Node.js s√≥ come√ßou a oferecer um suporte est√°vel para o sistema de m√≥dulos ES6 a partir da vers√£o 14. A expectativa √© que em um futuro pr√≥ximo esse padr√£o, que agora √© oferecido de forma nativa, se torne o recomendado. Por√©m, por ser um recurso recente, ainda n√£o conquistou o espa√ßo que at√© ent√£o √© ocupado pelo CommonJS.

Se voc√™ tentar utilizar os m√≥dulos ES6 em um projeto Node.js de forma padr√£o, voc√™ poder√° se deparar com o seguinte erro no seu terminal¬†`SyntaxError: Cannot use import statement outside a module`.

> Por ainda n√£o ser o padr√£o recomendado, √© necess√°ria a adi√ß√£o de uma chave no arquivo¬†`package.json`¬†(este arquivo ser√° abordado na li√ß√£o¬†`NPM`) antes que seja poss√≠vel utilizar as importa√ß√µes do ES6.

Felizmente, o pr√≥prio erro sugere 2 solu√ß√µes de como resolver esse problema:

1Ô∏è‚É£ Trocar a extens√£o dos arquivos de¬†`.js`¬†para¬†`.mjs`. No qual o erro aparecera da seguinte forma:

> `(node:4871) Warning: To load an ES module, set "type": "module" in the package.json or use the .mjs extension.`. ;

2Ô∏è‚É£ Adicionar no arquivo¬†`package.json`¬†a chave¬†`type`¬†com o valor¬†`module`, exemplo:

```json
// package.json
{
  ...
  "type": "module",
  ...
}
```

Vale destacar que antes de se tornar um recurso nativo, s√≥ era poss√≠vel utilizar o padr√£o ES6 no Node.js por meio de transpiladores como o¬†[Babel](https://babeljs.io/), ou supersets da linguagem, como o¬†[TypeScript](https://www.typescriptlang.org/).

> **Transpiladores**¬†s√£o ferramentas que leem o c√≥digo-fonte escrito em uma linguagem como o Node.js e produzem o c√≥digo equivalente em outra linguagem.
> 
> **Supersets**¬†s√£o linguagens que utilizam um transpilador para adicionar novas funcionalidades ao JavaScript.

Para saber mais sobre m√≥dulos ES6 e transpiladores, acesse a se√ß√£o de Recursos adicionais (opcional).

## CommonJS

No CommonJS as palavras-chaves utilizadas para importa√ß√£o e exporta√ß√£o de m√≥dulos s√£o, respectivamente,¬†`require()`¬†e¬†`module.exports`.

O CommonJS √© o sistema de m√≥dulos padr√£o do Node.js e, portanto, o sistema que utilizaremos daqui para frente.

## Exportando m√≥dulos

Para exportar algo no sistema CommonJS, utilizamos a vari√°vel global¬†`module.exports`, atribuindo a ela o valor que desejamos exportar:

```js
// brlValue.js
const brl = 5.37;

module.exports = brl;
```

-   Note como utilizamos as palavras-chave¬†`module.exports`.

> Como vimos anteriormente, um m√≥dulo possui um escopo isolado, ou seja, suas fun√ß√µes, vari√°veis, classes e demais defini√ß√µes existem somente dentro do m√≥dulo.

O¬†`module.exports`¬†nos permite definir quais desses ‚Äúobjetos‚Äù internos ao m√≥dulo ser√£o¬†**exportados**, ou seja, estar√£o acess√≠veis para os arquivos que importarem aquele m√≥dulo. Ele pode receber¬†**qualquer valor v√°lido em JavaScript, incluindo objetos, classes, fun√ß√µes e afins.**

No arquivo acima, estamos exportando do nosso m√≥dulo o valor da constante¬†`brl`(que √©¬†`5.37`), ao importarmos esse m√≥dulo, receber√≠amos o valor¬†`5.37`¬†como resposta. Apesar disso funcionar, exportar um √∫nico valor constante assim n√£o √© comum. Vamos observar um caso que acontece com mais frequ√™ncia:

```js
// brlValue.js
const brl = 5.37;

const usdToBrl = (valueInUsd) => valueInUsd * brl;

module.exports = usdToBrl;
```

üí™**Agora,vamos trazer isso para a pr√°tica!**

Imagine que estamos exportando uma fun√ß√£o, de modo que podemos utiliz√°-la para converter um valor em d√≥lares para outro valor,neste caso em reais.

O uso desse nosso m√≥dulo se daria da seguinte forma:

```js
// index.js
const convert = require('./brlValue');

const usd = 10;
const brl = convert(usd);

console.log(brl) // 53.7
```

Perceba que podemos dar o nome que quisermos para a fun√ß√£o depois que a importamos, independente de qual √© o seu nome dentro do m√≥dulo.

Suponha que agora desejamos exportar tanto a fun√ß√£o de convers√£o quanto o valor do d√≥lar (a vari√°vel¬†`brl`). Para isso, podemos exportar um objeto contendo as duas constantes da seguinte forma:

```js
// brlValue.js
const brl = 5.37;

const usdToBrl = (valueInUsd) => valueInUsd * brl;

module.exports = {
  brl,
  usdToBrl,
};
```

Desse modo, ao importarmos o m√≥dulo receberemos o seguinte objeto como resposta:

```js
// index.js
const brlValue = require('./brlValue');

console.log(brlValue); // { brl: 5.37, usdToBrl: [Function: usdToBrl] }

console.log(`Valor do d√≥lar: ${brlValue.brl}`); // Valor do d√≥lar: 5.37
console.log(`10 d√≥lares em reais: ${brlValue.usdToBrl(10)}`); // 10 d√≥lares em reais: 53.7
```

Como estamos lidando com um objeto, podemos utilizar¬†_object destructuring_¬†para transformar as propriedades do objeto importado em constantes no escopo global:

```js
const { brl, usdToBrl } = require('./brlValue');

console.log(`Valor do d√≥lar: ${brl}`); // Valor do d√≥lar: 5.37
console.log(`10 d√≥lares em reais: ${usdToBrl(10)}`); // 10 d√≥lares em reais: 53.7
```


## Importando m√≥dulos

A seguir, voc√™ ver√° como utilizar o¬†`require`¬†para importar cada tipo de m√≥dulo.

### M√≥dulos locais

Quando queremos importar um m√≥dulo local, precisamos passar para o¬†`require`¬†o caminho do m√≥dulo, seguindo a mesma assinatura.

-   Por exemplo:¬†`require('./meuModulo')`. Note que a extens√£o (`.js`) n√£o √© necess√°ria. Por padr√£o, o Node j√° procura por arquivos terminados em¬†`.js`¬†ou¬†`.json`¬†e os considera como m√≥dulos.

Al√©m de importarmos um arquivo como m√≥dulo, podemos importar uma pasta. Isso √© √∫til, pois muitas vezes um m√≥dulo est√° dividido em v√°rios arquivos, por√©m, desejamos importar todas as suas funcionalidades de uma √∫nica vez. Nesse caso, a pasta precisa conter um arquivo chamado¬†`index.js`, o qual importa cada um dos arquivos do m√≥dulo e os exporta da forma mais conveniente.

Por exemplo:

```js
// meuModulo/funcionalidade-1.js

module.exports = function () {
  console.log('funcionalidade1');
}
```

```js
// meuModulo/funcionalidade-2.js

module.exports = function () {
  console.log('funcionalidade2');
}
```

```js
// meuModulo/index.js
const funcionalidade1 = require('./funcionalidade-1');
const funcionalidade2 = require('./funcionalidade-2');

module.exports = { funcionalidade1, funcionalidade2 };
```

No exemplo acima, quando importarmos o m√≥dulo¬†`meuModulo`, teremos um objeto contendo duas propriedades, as quais s√£o as funcionalidades que exportamos dentro de¬†`meuModulo/index.js`.

Para importarmos e utilizarmos o m√≥dulo¬†`meuModulo`, basta passar o caminho da pasta como argumento para a fun√ß√£o¬†`require`, desse modo:

```js
// minha-aplicacao/index.js
const meuModulo = require('./meuModulo');

console.log(meuModulo); // { funcionalidade1: [Function: funcionalidade1], funcionalidade2: [Function: funcionalidade2] }

meuModulo.funcionalidade1();
```

## M√≥dulos internos

Para utilizarmos um m√≥dulo interno, devemos passar o nome do pacote como par√¢metro para a fun√ß√£o¬†`require`. Por exemplo,¬†`require('fs')`¬†importa o pacote¬†`fs`, respons√°vel pelo sistema de arquivos.

Uma vez que importamos um pacote, podemos utiliz√°-lo no nosso c√≥digo como uma vari√°vel da seguinte forma:


```js
const fs = require('fs');

fs.readFileSync('./meuArquivo.txt');
```

Repare que o nome da vari√°vel pode ser qualquer um que escolhermos. O importante √© o nome do pacote que passamos como par√¢metro para o¬†`require`.

## M√≥dulos de terceiros

M√≥dulos de terceiros s√£o importados da mesma forma que os m√≥dulos internos: passando seu nome como par√¢metro para a fun√ß√£o¬†`require`. A diferen√ßa √© que, como esses m√≥dulos n√£o s√£o nativos do Node.js, precisamos primeiro instal√°-los na pasta do projeto em que queremos utiliz√°-los.

Anota a√≠ üñä: O registro oficial do Node.js, em que milhares de pacotes est√£o dispon√≠veis para serem instalados, √© o¬†`npm`. Al√©m disso,¬†`npm`¬†tamb√©m √© o nome da ferramenta de linha de comando (CLI -¬†_command line interface_), respons√°vel por baixar e instalar esses pacotes. O CLI¬†`npm`¬†√© instalado juntamente com o Node.js.

Quando importamos um m√≥dulo que n√£o √© nativo do Node.js e que n√£o aponta para um arquivo local, o Node inicia uma busca por esse m√≥dulo. Essa busca acontece na pasta¬†`node_modules`. Caso um m√≥dulo n√£o seja encontrado na¬†`node_modules`¬†mais pr√≥xima do arquivo que o chamou, o Node procurar√° por uma pasta¬†`node_modules`¬†na pasta que cont√©m a pasta atual. Caso encontrado, o m√≥dulo √© carregado. Caso contr√°rio, o processo √© repetido em um n√≠vel de pasta acima. Isso acontece at√© que o m√≥dulo seja encontrado ou at√© que uma pasta¬†`node_modules`¬†n√£o exista no local em que o Node est√° procurando.

![Fluxograma de importa√ß√£o de arquivos node](https://content-assets.betrybe.com/prod/3aea70b5-b9a6-48d7-b701-a63bb8f75d5e-Fluxo.png)


###### Fonte: [Curse](https://app.betrybe.com/learn/course/5e938f69-6e32-43b3-9685-c936530fd326/module/94d0e996-1827-4fbc-bc24-c99fb592925b/section/2ed87e4f-9049-4314-8091-8f71b1925cf6/day/08afed28-2d18-4256-a8b9-a15ae8eb3375/lesson/3ec54ace-ebb1-416d-b899-d3050dd8d8b7)
